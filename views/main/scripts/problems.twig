$scope.model = {};

{% if word %}
    {% set word_feedback = word.feedback_by_me %}

    $scope.model.word = {
        word_id: {{ word.id }},
        dislike: {{ word_feedback.is_disliked ? 'true' : 'false' }},
        withTypo: {{ word_feedback.typo ? 'true' : 'false' }},
        typo: {% if word_feedback.typo %}'{{ word_feedback.typo }}'{% else %}null{% endif %},
        withDuplicate: {{ word_feedback.duplicate ? 'true' : 'false' }},
        duplicate: {% if word_feedback.duplicate %}'{{ word_feedback.duplicate.word }}'{% else %}null{% endif %},
        mature: {{ word_feedback.is_mature ? 'true' : 'false' }}
    };
{% endif %}

{% if association %}
    {% set association_feedback = association.feedback_by_me %}

    $scope.model.association = {
        association_id: {{ association.id }},
        dislike: {{ association_feedback.is_disliked ? 'true' : 'false' }},
        mature: {{ association_feedback.is_mature ? 'true' : 'false' }}
    };
{% endif %}

$scope.problemsDialog = () => {
    showModal('problems');
};

$('#problemsForm').submit(function(e) {
    $scope.modalPrePost(e);

    let obj = $.extend(true, {}, $scope.model);

    if (obj.word) {
        if (obj.word.withTypo !== true) {
            delete obj.word.typo;
        }

        if (obj.word.withDuplicate !== true) {
            delete obj.word.duplicate;
        }

        delete obj.word.withTypo;
        delete obj.word.withDuplicate;
    }

    $scope.modalAjax({
        url: '{{ path_for('actions.feedback') }}',
        data: obj,
        view: 'problems',
        onSuccess: $scope.postSuccess,
        noSuccessMessage: true
    });
});

$scope.focusTypo = () => {
    if ($scope.model.word.withTypo) {
        setTimeout(() => {
            $('#problemsWordTypo').focus();
        }, 100);
    }
};

$scope.focusDuplicate = () => {
    if ($scope.model.word.withDuplicate) {
        setTimeout(() => {
            $('#problemsWordDuplicate').focus();
        }, 100);
    }
};
